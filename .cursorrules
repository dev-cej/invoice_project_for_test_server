# PDF 데이터 추출 및 검수 웹 애플리케이션 기획서

## **프로젝트 개요**
- **목표**: PDF 파일에서 데이터를 추출하고 검수하며, 최종적으로 CSV/Excel 형식으로 저장 가능한 웹 애플리케이션 개발.
- **대상 파일**: 텍스트 기반 PDF 파일 (이미지 기반 PDF는 추후 OCR로 처리 예정).
- **주요 기능**:
  - 파일 업로드 및 상태 확인
  - 데이터 추출 및 비교
  - 검수 및 반환 상태 설정
  - 결과 데이터 저장 (CSV/Excel)

---


## **기본 개발 요구사항**
1. **색상**: 기본 색상은 **블랙 & 화이트**.
2. **반응형 웹**: 다양한 화면 크기에서 사용 가능하도록 반응형으로 개발.
3. **스타일링**: `SCSS`를 사용하여 스타일 작성.
4. **디자인 업그레이드**: 디자인은 기본 레이아웃과 UX를 중심으로 설계하고, 추후 업그레이드 예정.

## **프로세스 설계**

### **1. 파일 업로드**
- **기능**:
  - PDF 파일 업로드 및 상태 표시.
  - 업로드된 파일의 상태(성공/실패)와 파일 유형(텍스트/이미지) 구분.
  - **텍스트 파일만 선택 가능**: 이미지로만 되어 있는 파일은 및 실패 파일은 체크 불가능하며 다음 로직에서 제외.
  
- **UI 구성**:
  - 테이블 형태로 파일 목록 표시:
    ```
| 선택     | 파일명         | 상태             | 파일 유형    |
|---------|---------------|------------------|------------|
| [✓]     | File1.pdf     | 성공             | 텍스트 파일 |
| [ ]     | File2.pdf     | 성공             | 이미지 파일 |
| [ ]     | File3.pdf     | 실패 (권한 오류) | -          |
| [✓]     | File4.pdf     | 성공             | 텍스트 파일 |
    ```

- **검증 로직**:
  1. 파일 유형이 텍스트인지 확인.
  2. 업로드 성공 여부 확인.
  3. 체크박스 활성화 조건:
      - 유형: 텍스트 파일.
      - 상태: 업로드 성공.

---

### **2. 데이터 추출**
- **기능**:
  - 선택된 텍스트 파일에서 데이터 추출.
  - 추출된 데이터와 유저 수동 입력 데이터를 비교.
  - PDF 미리보기와 데이터 하이라이트 제공.

- **UI 구성**:
  - 데이터 비교 테이블:
    ```
    | 파일명        | 항목명       | 추출된 데이터         | 수동 입력 필드      | 비교 상태   |
    |--------------|-------------|---------------------|-------------------|-----------|
    | File1.pdf    | INVOICE №   | 2024/17/2575        | [__________]       | 일치       |
    | File1.pdf    | DATE        | 2024-12-30          | [2024-12-29]       | 불일치     |
    ```

- **PDF 미리보기**:
  - 클릭한 데이터 항목의 위치를 PDF에서 하이라이트.
  - PDF.js를 활용해 구현.

---

### **3. 데이터 검수**
- **기능**:
  - 추출된 데이터와 수동 입력 데이터를 기준으로 검수.
  - NG 항목 반환 상태와 사유 표시.
  - 검수 완료 후 반환 상태 요약 제공.

- **UI 구성**:
  - 검수 데이터 테이블:
    ```
    | 파일명        | 항목명       | 추출된 데이터         | 수동 입력 필드      | 상태       | 반환 사유   |
    |--------------|-------------|---------------------|-------------------|-----------|-----------|
    | File1.pdf    | INVOICE №   | 2024/17/2575        | 2024/17/2575       | 정상       | -         |
    | File1.pdf    | DATE        | 2024-12-30          | 2024-12-29        | NG        | 날짜 형식 불일치 |
    ```

- **검수 로직**:
  1. 데이터 비교 결과를 상태로 표시 (정상/NG).
  2. NG 항목의 반환 사유 입력 (선택 박스 활용).

---

### **4. 결과 저장**
- **기능**:
  - 데이터 추출 후 결과 및 검수 후 결과를 CSV/Excel로 저장.

- **파일 형식**:
  - **데이터 추출 후**:
    ```
    | 파일명        | 항목명       | 추출된 데이터         | 수동 입력 필드      |
    |--------------|-------------|---------------------|-------------------|
    | File1.pdf    | INVOICE №   | 2024/17/2575        | 2024/17/2575       |
    | File1.pdf    | DATE        | 2024-12-30          | 2024-12-29        |
    ```

  - **검수 후**:
    ```
    | 파일명        | 항목명       | 추출된 데이터         | 수동 입력 필드      | 상태       | 반환 사유   |
    |--------------|-------------|---------------------|-------------------|-----------|-----------|
    | File1.pdf    | INVOICE №   | 2024/17/2575        | 2024/17/2575       | 정상       | -         |
    | File1.pdf    | DATE        | 2024-12-30          | 2024-12-29        | NG        | 날짜 형식 불일치 |
    ```


## 4. 검수 기준 및 요구사항

### 4.1 청구서 필수 기재 사항

1. **청구자 및 대리인 정보**:
    - 마스터 데이터(`支払先マスタ.xlsx`)에 등록된 항목이어야 함.
    - 등록되지 않은 경우 NG 처리 후 반환.

2. **청구처 정보**:
    - 받는 사람 주소는 반드시 회사 주소 형태로 기재 (개인 이름 사용 금지).

3. **계좌 정보**:
    - 청구서에 정확한 계좌 정보를 명확히 기재.

4. **거래 날짜 및 내용**:
    - 거래 발생 날짜와 내용을 명확히 기록.

5. **거래 금액**:
    - 금액을 명확히 기재하며, 통화 정보는 지급처 마스터 데이터와 연동.

### 4.2 파일명과 INVOICE 번호 일치 여부

1. **파일명과 INVOICE 번호 일치**:
    - INVOICE 번호(T, M, D로 시작)가 파일명과 일치해야 함.

2. **여러 INVOICE 번호 처리**:
    - INVOICE 번호 중 하나라도 파일명과 일치하면, 모든 번호를 쉼표로 구분하여 기록.

### 4.3 PDF 내 INVOICE 포함 조건

1. **INVOICE 포함 규칙**:
    - 하나의 PDF에는 하나의 INVOICE만 포함.

2. **페이지 위치**:
    - INVOICE는 반드시 PDF 1페이지에 포함.

### 4.4  추출 해야하는 데이터 항목 

| 항목명 | 데이터 예시 | 주의사항 |
| --- | --- | --- |
| 管理番号(관리번호) | 313777 | 외화 시스템 자동 생성, 중복 불가. |
| 支払先(지불처) | 80 | 마스터 데이터에 등록된 지급처. |
| INVOICE DATE | 2024/08/31 | yyyy/mm/dd 형식으로 통일. |
| INVOICE № | 2024/17/2575 | 정확히 기록. |
| AMOUNT BILLED | 99.00 | 청구 금액, 통화 정보는 지급처 마스터 데이터와 연동. |
| 仮案件№ (임시안건) | MA2024-0085-IQ-12 | 지정된 형식을 준수해야 함. |
| 이미지 여부 | 이미지 | PDF가 이미지로만 구성된 경우 "이미지"로 표시. |

### 4.5 임시 프로젝트 번호 형식 검증

1. **번호 형식**:
    - `T`로 시작: T + 숫자 6자리 + 하이픈 + 알파벳 2자리 (예: T190354-MY).
    - `M`로 시작: M + 알파벳 2자리 + 숫자 4자리 + 하이픈 + 숫자 4자리 + 하이픈 + 알파벳 2자리 + 하이픈 + 숫자 2자리 (예: MA2024-0009-KD-12).
    - `D`로 시작: D + 알파벳 2자리 + 숫자 4자리 + 하이픈 + 숫자 4자리 + 하이픈 + 알파벳 2자리 (예: DA2022-0197-CN).

2. **특수 처리**:
    - `T` 접두사의 `TFN`은 데이터베이스 저장 시 제외.
    - 예: TFN 200146-US → 추출 데이터: 200146-US.

### 4.6 문서 속성 관리

1. **T로 시작하는 번호**:
    - PDF 속성의 "주제" 필드에 관리번호 입력.
    - 예: PDF 속성과 우측 상단 주제란에 T123456-US 입력.

2. **M 또는 D로 시작하는 번호**:
    - 속성 입력 불필요.

---

## 5. 추가 요구사항 확인

1. **PDF 텍스트 위치 다양성**:
    - 동일한 텍스트 구조가 아니므로, 위치를 기반으로 데이터를 유연하게 추출하는 로직 필요.

2. **로그 생성**:
    - NG 데이터와 검수 결과를 기록할 수 있는 로그 시스템 구현 필요.

3. **다국어 지원**:
    - PDF에 포함된 데이터가 다국어로 제공될 가능성 대비.

---

위 지침서를 기반으로 프로젝트를 설계하고 요구사항에 맞는 기능을 단계적으로 개발할 수 있습니다.